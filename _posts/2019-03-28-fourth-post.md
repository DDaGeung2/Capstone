---
published: false
---


# 4. JNI와 NDK
---------------------

## 4.1 안드로이드와 JNI
---------------------

### 4.1.1 왜 안드로이드에사 JNI를 알아야 하는가?

- 안드로이드 프레임워크는 자바와 C/C++ 기반 모듈이 계층별로 구성되어 있음. 이들의 계층별 모듈 대부분은 서로 밀접하게 연관. 즉, C/C++ 레이어와 자바 레이어가 서로 상호 작용하면서 동작.
- 안드로이드 프레임워크에서 C/C++ 레이어(하위)와 자바 레이어(상위)가 유기적으로 동작하게 만들려면 이들을 상호 연결해주는 매개체 필요. 자바와 C/C++ 모듈 간의 인터페이스를 가능하게 해주는 이것이 바로 __JNI(Java Native Interface)__ .

- JNI(Java Native Interface)
     - 자바 이외의 언어(네이티브 언어)로 만들어진 모듈이나 애플리케이션과 자바 클래스가 서로 상호 작용할 수 있게 정의한 인터페이스.
     - JNI의 활용
		1. 빠른 처리 속도를 요구하는 루틴 작성: 네이티브 코드에 비해 자바는 느림. 따라서 C/C++로 작성하고 이를 JNI를 통해 자바에서 호출하는 방법으로 속도 UP.
        2. 하드웨어 제어: 하드웨어 제어코드 C로 작성 후 JNI 통해 자바 레이어와 연결하면 자바에서도 하드웨어 제어 가능.
        3. 기존 C/C++ 프로그램의 재사용: 굳이 자바로 동일코드 작성 필요 없이 JNI 통해 기존 코드 활용.
     - 성능 향상을 위해 JNI를 사용하려면 안드로이드에서 제공하는 NDK(Native Development Kit)를 이용하여 자바 애플리케이션과 연결 가능한 C/C++ 기반의 네이티브 라이브러리를 작성해야 함.
---------------------

## 4.2 JNI의 기본 원리 이해
---------------------  
### 4.2.1 자바에서 C 라이브러리 함수 호출하기: 콘솔 화면에 문자열 출력

- 개발 순서: 자바코드 작성 → 자바코드 컴파일 → C 헤더파일 생성 → C 코드 작성 → C 공유 라이브러리 생성 → 자바 프로그램 실행.

#### 1. 자바코드 작성
- JNI를 통해 C로 구현된 함수를 호출하려면 단순히 자바 클래스에 네이티브 메서드를 선언하기만 하면 됨.
- 네이티브 메서드는 자바 메서드이긴 하지만 실제로 자바가 아닌 C/C++ 같은 네이티브 언어로 작성된 함수.
- JNI 네이티브 함수는 C/C++ 코드로 실제 구현된 함수.

- ![20190327_233152](https://user-images.githubusercontent.com/48465809/55142276-97bdb700-517f-11e9-9d8a-b84ac63e6fbc.jpg)
	1. 자바 클래스에서 native 키워드를 이용하여 C/C++로 작성된 JNI 네이티브 함수와 연결할 메서드 선언.
    	- native 키워드는 자바컴파일러에게 이 키워드가 선언된 메서드는 실제 자바가 아닌 외부의 다른 언어로 구현돼 있음을 알려주는 역할. 따라서 자바로 작성된 구현부는 X.
   	2. 네이티브 메서드가 실제로 구현되어 있는 C 라이브러리를, 인자로 넘긴 문자열에 해당하는 네이티브 라이브러리를 로딩하는 메서드인 System.loadLibrary((여기서는)"hellojni") 를 호출해서 로딩.
		- 일반적으로 자바에서 네이티브 라이브러리를 로드하는 방법은 static block을 사용하는 것.메서드를 호출하는 시점보다 먼저 C 라이브러리를 로딩해야 오류가 발생하지 X.
	3. main() 함수에서 자바 객체 생성 및 객체의 네이티브 메서드르 호출해서 실제 JNI 네이티브 함수를 호출.


















#### 2. 자바코드 컴파일
#### 3. C 헤더파일 생성
#### 4. C코드 작성
#### 5. C 공유 라이브러리 생성
#### 6. 자바프로그램 실행


        
